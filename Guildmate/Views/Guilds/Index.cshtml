@using Microsoft.AspNetCore.Identity;

@model IEnumerable<Guildmate.Models.Guild>
@inject UserManager<ApplicationUser> userManager
@{
    ViewData["Title"] = "Index";
}

<h1>Guilds</h1>
<p>
    <a asp-action="Create">Create New Guild</a>
</p>

<form class="form-inline my-2 my-lg-0" asp-controller="Guilds" asp-action="Index">
    <input class="form-control mr-sm-2" type="text" name="searchString" placeholder="Server Name">
    <button class="btn btn-secondary my-2 my-sm-0 compSearch" type="submit">Filter</button>
</form>
<hr />

@Html.ActionLink("Horde Guilds", "Index", new { filter = "horde" }, new { @class = "btn btn-primary" })
@Html.ActionLink("Alliance Guilds", "Index", new { filter = "alliance" }, new { @class = "btn btn-primary" })
@Html.ActionLink("Show All guilds", "Index", new { filter = "all" }, new { @class = "btn btn-primary" })

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Server)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Faction)
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Server.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Faction.Name)
            </td>
           @if(userManager.GetUserAsync(User).Result.Characters.FirstOrDefault(c => c.ClassRace.Race.FactionId == item.FactionId) != null)
            {
            <td>
                      <form asp-action="JoinGuild"  asp-route-id="@item.GuildId" asp-controller="Characters">
                          <input type="hidden" value="@item.GuildId" name="GuildId" />
                          <input type="submit" value="Join Guild" />
                      </form>

            </td>
                }
            </tr>
        }
    </tbody>
</table>
